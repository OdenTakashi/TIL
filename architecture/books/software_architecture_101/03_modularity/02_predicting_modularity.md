# ソフトウェアアーキテクチャの基礎 -エンジアリングに基づく体系的なアプローチ-
- Mark Richards, Near Ford 著
- 島田浩二 訳

## モジュール性の予測
- モジュール性を把握するツール
  - 凝集度
  - 結合度
  - コナーセンス

### 凝集度(Cohesion)
- 関連する要素全てが一箇所にまとまっている状態が理想
  - 呼出時に要素結合が必要になってしまうため

凝集度の尺度
- 機能的凝集
  - ここ関連する要素の構成されている
- 逐次的凝集
  - 出力データを入力するといった2つのモジュールが相互に作用している
- 通信的凝集
  - 関連するデータを軸に複数の責務を持っている
- 手続的凝集
  - 実行する順番という括りでまとまっている
- 時間的凝集
  - 実行するタイミングという括りでまとまっている
- 論理的凝集
  - データ依存、手順依存はないが種類が似ている状態
- 偶発的凝集
  - 同じソースファイル内にあるという関連の状態

- 複数尺度はあるが、精度は低い
  - アークテクチャの裁量によるため

- LCOM(Lack Of Cohesion Methods: メソッド凝集度の欠如)
  - フィールドを介してめめ結合されていメソッド群の総和
  - 高いと、凝集度が低い状態である
  - 凝集度が低い場合は、クラスとして切り出すか、状態を意識しないならmoduleとして切り出す
    - メソッドがどのフィールドを触っているかを分析し、単体からしか触られていないフィールド & メソッドがある場合は切り出すといいかも..?
    - ここでも論論理的な分離のみを目指す

### 結合度
- 結合度を測る道具
  - 求正性結合
    - 外部から入力される接続数
  - 遠心性結合
    - 出力する接続数

### 抽象度、不安程度、主系列からの距離
- 抽象度
  -  抽象的なアーティファクトと具体的なアーティファクトの比率のこと
    - 抽象クラスと実装のコードは行数だけ見ても多い
    - それが1:1000 -> 100:1000の場合、前者は限りなく0に近いが後者は、0.1である

- 不安程度
  - クラスが他の多いクラスに処理を移譲している場合
    - 他のクラスのどれかが壊れたら壊れてしまう..

### 種系列からの距離
- 抽象度と不安程度の理想的な関係

### コナーセンス
- システムの正しさを維持するためあるコンポーネントに編集を加える際2つのコンポーネントにも変更を加える場合、それらはコナーセンス(接続)されている

#### 静的なコナーセンス
- 結合の度合いとして以下がある
  - 名前のコナーセンス
    - 複数のコンポーネントがメソッド名のみを介して結合している状態
    - 元のメソッド名を変えたら、呼出側もメソッド名のみを変更するケース
    - 望ましい結合方法
  - 型のコナーセンス
    - 複数コンポーネントが引数を介して結合している状態
    - 元の受け取る引数を変えた場合、呼び出し側か変える必要があるケース
  - 意味のコナーセンス
    - 特定の変数などの値を前提として結合している状態
    - xxx if instance.varriable == 2 のように複数箇所でvariableに依存しているケース。
      - 修正の際に複数箇所対応が必要。
      - 定数に切り出すか、Enumで切り出すか、メソッドに切り出す..
  - 位置のコナーセンス
    - メソッド引数の位置に依存している場合
    - 実装元で引数順序を変えた場合、呼び出し元も変更するケース
  - アルゴリズムのコナーセンス
    - 複数コンポーネントが一定のアルゴリズムを使う前提
    - アルゴリズムを変更したい場合、複数コンポーネントを修正する必要がある

#### 動的なコナーセンス
- 実行時の呼び出しを分析するもの
- 実行順序のコナーセンス
  - 外部コンポーネントから順序を守って叩かないと壊れるパターン
- タイミングのコナーセンス
  - 同時実行などで壊れてしまい、競合するパターン
- 値のコナーセンス
  - ペアで動く値の場合整合が取れていないと壊れてしまうケース
- アイデンティティのコナーセンス
  - 特定のIDを持つインスタンスに依存しているケース
  - user_idが1に依存している場合など

### コナーセンスの性質
- 強さ
  - どれだけ容易にリファクタリングできるか
  - よりよい種類のコナーセンスに向かうようにリファクタリングをする必要がある
- 動的よりも静的なコナーセンスを好むべき
  - 単純なコード解析によって改善点を見つけれるため
- 位置関係
  - 同じコンポーネント内で強いコナーセンスがある場合はそこまで問題にならない
  - 位置関係が遠い同士の場合は要注意
- 度合い
  - コナーセンスが与えるクラスはわずかなのか考える

- モジュール性向上のため
  - カプセル化で分割することで全体的なコナーセンス度合いを下げることができる
  - 境境界を跨ぐ場合コナーセンスは最小にすべき
  - カプセル化内であれば度合いを最大化しても良い
  - 強いコナーセンスは弱くしよう
  - 距離が遠い場合はコナーセンスを弱くしよう
